<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <link rel="icon" type="image/png" href="img/logo.png">

    <title>SongID</title>

    <link rel="stylesheet" type="text/css" href="css/index.css">

    <script src="//cdn.webrtc-experiment.com/RecordRTC.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
    <script>
        // Make getUserMedia work for any browser
        navigator.getUserMedia = navigator.getUserMedia ||
                navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

        // In this session, record only audio
        var session = {
            audio: true,
            video: false
        };

        // Establish a stream and record
        var recordRTC = null;
        var audioStream = null;

        function initializeRecorder() {
            $("#brand-logo")[0].textContent = "Recording";
            navigator.getUserMedia(session, function (stream) {
                audioStream = stream;
                recordRTC = RecordRTC(stream, {
                    recorderType: StereoAudioRecorder // optionally force WebAudio API to record audio
                });
                recordRTC.startRecording();

            }, function (error) {
                console.log(error);
            });
        }

        function stopRecorder() {
            $("#brand-logo")[0].textContent = "Stopped";
            audioStream.stop();
            audioStream = null;
            recordRTC.stopRecording(function (audioURL) {
                console.log(audioURL);
                var formData = new FormData();
                formData.append('audio', recordRTC.getBlob());

                $.ajax({
                    type: 'POST',
                    url: 'identify',
                    data: formData,
                    contentType: false,
                    cache: false,
                    processData: false
                }).done(function(data) {
                    for (var match in data.matches) {
                        var metadata = data.matches[match].metadata;
                        console.log(metadata.artist + ' - ' + metadata.title);
                    }
                });
            });
        }
    </script>
    <script>
        // Record button
        $(document).ready(function () {
            var recording = false;
            $("#brand-logo")[0].addEventListener("click", function () {
                recording = !recording; // change state
                if (recording === true) {
                    initializeRecorder();
                    setTimeout(function() {
                        if (recording === true) {
                            stopRecorder();
                        }
                    }, 10000);
                } else {
                    stopRecorder();
                }
            });
        });
    </script>




    <h1 id="title">Start. Record. Discover.</h1>
    <div class="header">
       <img src="img/logo.png" id="brand-logo">
    </div>
    


    

    <script type="text/javascript">

        function setTitle(title){
            $("#title").text(title);
            console.log(title);
        };


        $("#brand-logo").hover(function(){
            if($("#title").text() == "Start. Record. Discover.")
                $("#title").text("Start");
        });
        $("#brand-logo").click(function(){
            if($("#title").text() == "Start"){
                setTitle("Listening...");

                setTimeout(function() {
                    setTitle("Processing...");
                }, 10000);
            };
            rotateAnimation("brand-logo", 10);
        });

    </script>
    <script type="text/javascript">
        var degrees = 0;
        var looper;
        function rotateAnimation(id,speed){
            var elem = document.getElementById(id);
            elem.style.WebkitTransform = "rotate("+degrees+"deg)";
            looper = setTimeout('rotateAnimation(\''+id+'\','+speed+')',speed);
            degrees++;
            if(degrees > 359){
                degrees = 1;
            }
        }

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="//cdn.webrtc-experiment.com/RecordRTC.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
    <script>
        // Make getUserMedia work for any browser
        navigator.getUserMedia = navigator.getUserMedia ||
                navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

        // In this session, record only audio
        var session = {
            audio: true,
            video: false
        };

        // Establish a stream and record
        var recordRTC = null;

        function initializeRecorder() {
            $("button")[0].textContent = "Recording";
            navigator.getUserMedia(session, function (stream) {
                recordRTC = RecordRTC(stream, {
                    recorderType: StereoAudioRecorder // optionally force WebAudio API to record audio
                });
                recordRTC.startRecording();

            }, function (error) {
                console.log(error);
            });
        }

        function stopRecorder() {
            $("button")[0].textContent = "Stopped";
            recordRTC.stopRecording(function (audioURL) {
                console.log(audioURL);
                var formData = new FormData();
                formData.append('audio', recordRTC.getBlob());

                $.ajax({
                    type: 'POST',
                    url: 'identify',
                    data: formData,
                    contentType: false,
                    cache: false,
                    processData: false
                }).done(function(data) {
                    for (var match in data.matches) {
                        var metadata = data.matches[match].metadata;
                        console.log(metadata.artist + ' - ' + metadata.title);
                    }
                });
            });
        }
    </script>
    <script>
        // Record button
        $(document).ready(function () {
            var recording = false;
            $("button")[0].addEventListener("click", function () {
                recording = !recording; // change state
                if (recording === true) {
                    initializeRecorder();
                    setTimeout(function() {
                        if (recording === true) {
                            stopRecorder();
                        }
                    }, 10000);
                } else {
                    stopRecorder();
                }
            });
        });
    </script>
    <button>Start</button>
</body>
</html>